{% if products.has_other_pages %}
    <nav aria-label="Page navigation">
        <ul class="pagination justify-content-center{% if is_shop %} shop-pagination{% endif %}">
            {% if products.has_previous %}
                <li class="page-item">
                    <a class="page-link" href="?{{ querystring }}{% if querystring %}&{% endif %}page={{ products.previous_page_number }}" aria-label="Previous"><span aria-hidden="true">&laquo;</span></a>
                </li>
            {% else %}
                <li class="page-item disabled">
                    <span class="page-link">&laquo;</span>
                </li>
            {% endif %}

            {% comment %}
                Smart pagination: shows first/last, 2 before/after current, ellipsis as needed.
            {% endcomment %}
            {% with total=products.paginator.num_pages current=products.number %}
                {% for num in products.paginator.page_range %}
                    {% if num == 1 or num == total %}
                        {# Always show first/last page #}
                        {% if num == current %}
                            <li class="page-item active">
                                <span class="page-link">{{ num }}</span>
                            </li>
                        {% else %}
                            <li class="page-item">
                                <a class="page-link" href="?{{ querystring }}{% if querystring %}&{% endif %}page={{ num }}">{{ num }}</a>
                            </li>
                        {% endif %}
                    {% elif num >= current|add:"-1" and num <= current|add:"1" %}
                        {# Show pages within -1/+1 of current #}
                        {% if num == current %}
                            <li class="page-item active">
                                <span class="page-link">{{ num }}</span>
                            </li>
                        {% else %}
                            <li class="page-item">
                                <a class="page-link" href="?{{ querystring }}{% if querystring %}&{% endif %}page={{ num }}">{{ num }}</a>
                            </li>
                        {% endif %}
                    {% elif num == current|add:"-2" or num == current|add:"2" %}
                        {# Ellipsis if there is a gap #}
                        <li class="page-item disabled">
                            <span class="page-link">...</span>
                        </li>
                    {% endif %}
                {% endfor %}
            {% endwith %}

            {% if products.has_next %}
                <li class="page-item">
                    <a class="page-link" href="?{{ querystring }}{% if querystring %}&{% endif %}page={{ products.next_page_number }}" aria-label="Next"><span aria-hidden="true">&raquo;</span></a>
                </li>
            {% else %}
                <li class="page-item disabled">
                    <span class="page-link">&raquo;</span>
                </li>
            {% endif %}
        </ul>
    </nav>
{% endif %}
