{% extends 'base.html' %}
{% load static %}
{% load humanize %}

{% block title %}
    {{ category.get_full_name_path }}{% if category.meta_title %}
        - {{ category.meta_title }}
    {% endif %}
{% endblock %}

{% block meta_description %}
    {% if category.meta_description %}
        {{ category.meta_description }}
    {% else %}
        {{ category.title }}
    {% endif %}
{% endblock %}

{% block content %}
    {% include 'partials/_breadcrumbs.html' %}

    <section class="middle">
        <div class="container">
            <!-- Category Title -->
            <h1 class="fw-bold mb-4">{{ category.title }}</h1>
            <!-- Subcategories Section -->
            {% if category.description %}
                <div class="mb-3 fs-sm">{{ category.description|safe }}</div>
            {% endif %}
            {% if subcategories|length > 1 and not all_sub_mode %}
                <div class="mb-5">
                    <h3 class="fw-bold">Колекции</h3>
                    <div class="row g-3 g-md-4">
                        {% for sub in subcategories %}
                            {% if not sub.is_all or products|length == 0 %}
                                <div class="col-6 col-md-4 col-lg-3">
                                    <a class="subcategory-card" href="{% if sub.is_all %}{% url 'store:category_all_sub' category.get_full_path %}{% else %}{{ sub.get_absolute_url }}{% endif %}">
                                        <div class="subcategory-card-media">
                                            {% if sub.marketing_image %}
                                                {% include 'store/_hover_image.html' with image=sub.marketing_image hover_image=sub.hover_image alt=sub.title %}
                                            {% endif %}
                                            <div class="subcategory-card-overlay">
                                                <div class="subcategory-card-title">
                                                    {% if sub.is_all %}
                                                        Всички {{ category.title }}
                                                    {% else %}
                                                        {{ sub.title }}
                                                    {% endif %}
                                                </div>
                                            </div>
                                        </div>
                                    </a>
                                </div>
                            {% endif %}
                        {% endfor %}
                    </div>
                </div>
            {% endif %}

            {% if category.marketing_image or category.hover_image %}
                <div class="category-page row mb-5 gx-4">
                    <div class="col-12 col-md-6">
                        <div class="category-img-wrapper w-100">
                            <img src="{{ category.marketing_image.url }}" class="img-fluid main-img" alt="{{ category.title }}" />
                            {% if category.hover_image %}
                                <img src="{{ category.hover_image.url }}" class="img-fluid hover-img d-md-none" alt="{{ category.title }}" />
                            {% endif %}
                        </div>
                    </div>
                    {% if category.hover_image %}
                        <!-- On desktop, show hover image separately, no hover effect -->
                        <div class="col-md-6 d-none d-md-flex">
                            <div class="category-img-wrapper w-100">
                                <img src="{{ category.hover_image.url }}" class="img-fluid main-img" alt="{{ category.title }}" />
                            </div>
                        </div>
                    {% endif %}
                </div>
            {% endif %}

            <!-- Product List -->
            <div class="row align-items-center rows-products" id="products-list">
                {% for product in products %}
                    {% include 'partials/_product_list.html' with product=product %}
                {% endfor %}
            </div>

            {% include 'partials/_pagination.html' %}
        </div>
    </section>
{% endblock %}
