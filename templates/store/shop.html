{% extends 'partials/base.html' %} 
{% load static %} 
{% load humanize %}

{% block content %}
	{% include "partials/_breadcrumbs.html" %}
	
	<section class="middle">
		<div class="container">
			<!-- Page Title & Search -->
			<h2 class="fw-bold mb-5">Всички продукти (<span class="product_count">{{ products_list.count }}</span>)</h2>
			<div class="mb-5 d-flex justify-content-between align-items-center gap-2">
				<input type="text" class="form-control rounded search-filter" placeholder="Търси продукти..." name="search-filter" id="">
				<button class="btn bg-primary text-white rounded "><i class="fas fa-search"></i></button>
			</div>

			<div class="row">
				<!-- Sidebar Filters -->
				<div class="col-lg-3">
					<!-- Category Filter (Collapsible Nested) -->
					<div class="border rounded p-3 mb-3">
					    <h4>Категории</h4>
					    <ul class="category-filter-list list-unstyled">
					        {% for root in categories %}
					            <li>
					                <div class="d-flex align-items-center">
                                        <div class="form-check mb-1">
                                            <input type="checkbox" class="form-check-input category-filter" value="{{ root.id }}" id="cat{{ root.id }}">
                                            <label class="form-check-label fs-6" for="cat{{ root.id }}">{{ root.title }}</label>
                                        </div>
					                    {% if root.subcategories.all %}
					                        <button type="button" class="btn btn-link btn-sm ms-2" data-bs-toggle="collapse" data-bs-target="#subs{{ root.id }}" aria-expanded="false" aria-controls="subs{{ root.id }}">&#x25BC;</button>
					                    {% endif %}
					                    <span class="ms-auto text-muted small">{{ root.total_products }}</span>
					                </div>
					                {% if root.subcategories.all %}
					                    <ul class="subcategories collapse ms-4" id="subs{{ root.id }}">
					                        {% for sub in root.subcategories.all %}
					                            <li>
					                                <div class="d-flex align-items-center">
                                                        <div class="form-check mb-1">
                                                            <input type="checkbox" class="form-check-input category-filter" value="{{ sub.id }}" id="cat{{ sub.id }}">
                                                            <label class="form-check-label fs-6" for="cat{{ sub.id }}">{{ sub.title }}</label>
                                                        </div>
					                                    {% if sub.subcategories.all %}
					                                        <button type="button" class="btn btn-link btn-sm ms-2" data-bs-toggle="collapse" data-bs-target="#subs{{ sub.id }}" aria-expanded="false" aria-controls="subs{{ sub.id }}">&#x25BC;</button>
					                                    {% endif %}
					                                </div>
					                                {% if sub.subcategories.all %}
					                                    <ul class="subcategories collapse ms-4" id="subs{{ sub.id }}">
					                                        {% for subsub in sub.subcategories.all %}
					                                            <li>
                                                                <div class="form-check mb-1">
					                                                    <input type="checkbox" class="form-check-input category-filter" value="{{ subsub.id }}" id="cat{{ subsub.id }}">
					                                                    <label class="form-check-label fs-6" for="cat{{ subsub.id }}">{{ subsub.title }}</label>
                                                                </div>
					                                            </li>
					                                        {% endfor %}
					                                    </ul>
					                                {% endif %}
					                            </li>
					                        {% endfor %}
					                    </ul>
					                {% endif %}
					            </li>
					        {% endfor %}
					    </ul>
					</div>
					<!-- Price Filter -->
					<div class="border rounded p-3 mb-3">
						<h4>Цена</h4>
						<div  style="margin-left: -18px;">
							{% for p in prices %}
								<div class="mb-1 form-check">
									<input type="radio" name="price-filter" value="{{p.id}}" class="form-check-input " id="{{p.id}}">
									<label class="form-check-label fs-6" for="{{p.id}}">{{p.value}}</label>
								</div>
							{% endfor %}
						</div>
					</div>
					<!-- Display Filter -->
					<div class="border rounded p-3 mb-3">
						<h4>Резултати на страница</h4>
						<div  style="margin-left: -18px;">
							{% for i in item_display %}
								<div class="mb-1 form-check">
									<input type="radio" name="items-display" value="{{i.id}}" class="form-check-input items-display" id="display{{i.id}}">
									<label class="form-check-label fs-6" for="display{{i.id}}">{{i.value}}</label>
								</div>
							{% endfor %}
						</div>
					</div>
					<!-- Rating Filter -->
					<!-- <div class="border rounded p-3 mb-3">
						<div>
							<h4>Rating</h4>
							<div>
								{% for r in ratings %}
									<div class="mb-1 form-check d-flex justify-content-between align-items-center">
										<div>
											<input type="checkbox" class="form-check-input rating-filter" value="{{r.id}}" id="rating{{r.id}}">
											<label class="form-check-label fs-6" for="rating{{r.id}}">{{r.value}}</label>
										</div>
									</div>
								{% endfor %}
							</div>
						</div>
					</div> -->
					<!-- Size Filter -->
					<div class="border rounded p-3 mb-3">
						<h4>Размери</h4>
						{% for size in sizes %}
							<div class="form-check mb-1">
							<input type="checkbox" class="form-check-input size-filter" value="{{ size.content }}" id="size{{ forloop.counter }}">
							<label class="form-check-label" for="size{{ forloop.counter }}">{{ size.content }}</label>
							</div>
						{% endfor %}
					</div>
					<!-- Colors Filter -->
					<!-- <div class="border rounded p-3 mb-3">
						<h4>Цветове</h4>
						{% for c in colors %}
							<div class="mb-1 form-check d-flex justify-content-between align-items-center">
								<div class="d-flex align-items-center gap-2">
									<input type="checkbox" class="form-check-input colors-filter" value="{{c.content}}" id="{{c.content}}" >
									<label class="form-check-label fs-6 p-3 colors-filter" for="{{c.content}}" style="background-color: {{c.content}}; color: white; border-radius: 50%;"></label>
								</div>
							</div>
						{% endfor %}
					</div> -->
					<!-- Reset Filters Button -->
					<button class="btn bg-primary btn-sm rounded reset_shop_filter_btn">Премахни филтри <i class="fas fa-rotate ms-2"></i></button>
				</div>

				<!-- Products Section -->
				<div class="col-lg-9"> 
					<div class="row align-items-center rows-products" id="products-list">
					    {% for p in products %}
					        <div class="col-6 col-md-4 col-lg-3">
					            <div class="product_grid card b-0 rounded-3 shadow m-2 p-2">
					                <!-- Product Image -->
					                <div class="card-body p-0">
					                    <div class="shop_thumb position-relative">
					                        {% if p.category.parent %}
					                            <a class="card-img-top d-block overflow-hidden" href="{% url 'store:product_detail' p.category.parent.slug p.category.slug p.slug %}">
					                                <img class="card-img-top" style="width: 100%; height: 100%; object-fit: cover;" src="{{p.image.url}}" alt="..." />
					                            </a>
					                        {% else %}
					                            <a class="card-img-top d-block overflow-hidden" href="{% url 'store:product_detail_root' p.category.slug p.slug %}">
					                                <img class="card-img-top" style="width: 100%; height: 100%; object-fit: cover;" src="{{p.image.url}}" alt="..." />
					                            </a>
					                        {% endif %}
					                    </div>
					                </div>
					                <!-- Product Info -->
					                <div class="card-footer b-0 p-0 pt-2 bg-white d-flex align-items-start justify-content-between">
					                    <div class="text-left">
					                        <div class="elso_titl">
					                            <span class="small">{{p.category.title}}</span>
					                        </div>
					                        <h5 class="fs-md mb-0">
					                            {% if p.category.parent %}
					                                <a href="{% url 'store:product_detail' p.category.parent.slug p.category.slug p.slug %}">{{p.name}}</a>
					                            {% else %}
					                                <a href="{% url 'store:product_detail_root' p.category.slug p.slug %}">{{p.name}}</a>
					                            {% endif %}
					                        </h5>
					                        <div class="d-flex align-items-center justify-content-start gap-2">
					                            <!-- Price -->
					                            <div class="elis_rty mb-0">
					                                <span class="ft-bold text-dark fs-sm">{{p.price}} лв.</span>
					                            </div>
					                            <!-- Wishlist Icon -->
					                            <a href="#" class="add_to_wishlist text-center" data-product_id="{{p.id}}">
					                                <i class="fas fa-heart fs-6 text-dark"></i>
					                            </a>
					                        </div>
					                    </div>
					                </div>
					            </div>
					        </div>
					    {% endfor %}
					</div>
				</div>
			</div>

			<div id="pagination-block">{% include 'partials/_pagination.html' %}</div>
		</div>
	</section>
{% endblock content %}
